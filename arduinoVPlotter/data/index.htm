
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Test</title>
    <input type="text" id="test"  value="" />
    <button onclick="ws.send(document.getElementById('test').value)" id="testButton" >Send</button>
    <br/>

    <script type="text/javascript">
      var ws = null;

      function sendBlob(str){
          var buf = new Uint8Array(str.length);
          for (var i = 0; i < str.length; ++i) buf[i] = str.charCodeAt(i);
          ws.send(buf);
      }

      var myVar;
      var counts = 100;

      function testFunc(d) {
          if(counts == 100) {
              start = console.time("callAPITimer");
          }
          myVar = d;
          if(d[0] == 'S'){
              console.log("setup");
          } else if(d[0] == 'D') {
              console.log("data");
          } else {
              // Testing only
              if(counts > 0) {
                  counts -= 1;
                  sendBlob("S");
              } else {
                  console.timeEnd('callAPITimer');
              }
          }
      }
      function startSocket(){
          // ws = new WebSocket('ws://'+document.location.host+'/ws',['arduino']);
          ws = new WebSocket('ws://192.168.0.180/ws',['arduino']);
          ws.binaryType = "arraybuffer";
          ws.onerror = function(e){
              console.log("ws error", e);
          };
          ws.onmessage = function(e){
              var msg = "";
              if(e.data instanceof ArrayBuffer){
                  // msg = "BIN:" +
                  //      Array.prototype.map.call(new Uint8Array(e.data), x => ('00' + x.toString(16)).slice(-2)).join('');
                  testFunc(e.data);
              } else {
                  msg = "TXT:"+e.data;
              }
          };

      }
      function onBodyLoad(){
          startSocket();
      }
    </script>
  </head>
  <body id="body" onload="onBodyLoad()">
    <pre id="dbg"></pre>
    <div id="input_div">
      $<input type="text" value="" id="input_el">
    </div>
  </body>
</html>
